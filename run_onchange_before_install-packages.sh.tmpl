#!/bin/bash

set -e

{{ if eq .chezmoi.os "linux" -}}
echo "ğŸ§ Linux detected. Installing base dependencies..."
sudo apt update
sudo apt install -y build-essential procps curl file git
{{ else if eq .chezmoi.os "darwin" -}}
echo "ğŸ MacOS detected."
# xcode-select --install || true  # (ë§¥ì€ ì´ë¯¸ ë˜ì–´ìˆì„ í…Œë‹ˆ ì£¼ì„ ì²˜ë¦¬, í•„ìš”í•˜ë©´ í•´ì œ)
{{ end -}}

# 1. Homebrew ì„¤ì¹˜ (ì—†ìœ¼ë©´ ì„¤ì¹˜)
if ! command -v brew &> /dev/null; then
    echo "ğŸº Installing Homebrew..."
    /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
    
    {{ if eq .chezmoi.os "linux" -}}
    echo 'eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"' >> $HOME/.profile
    eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
    {{ end -}}
fi

# 2. Brewfile ì‹¤í–‰
# Brewfile ë‚´ìš©ì´ ë°”ë€Œë©´ ì´ ìŠ¤í¬ë¦½íŠ¸ë¥¼ ì¬ì‹¤í–‰í•˜ê²Œ ë§Œë“œëŠ” ë§¤ì§ ì½”ë“œ (í•´ì‹œê°’ ì²´í¬)
# Brewfile hash: {{ include "Brewfile" | sha256sum }}

echo "ğŸ“¦ Installing packages from Brewfile..."
brew bundle --file={{ joinPath .chezmoi.sourceDir "Brewfile" }}
